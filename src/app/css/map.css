.map-page .map-container {
  width: 100%;
  max-width: 320px;        /* スマホ幅に最適化 */
  background-color: #fff;
  box-sizing: border-box;
  border-radius: 4px;
  margin-bottom: 50px;
}

.map-page .textarea1 {
  width: 100%;
  box-sizing: border-box;
  line-height: 1.5;          /* 行間 */
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  resize: vertical;          /* 必要なら高さを縦方向だけ変更可 */
  min-height: calc(1.5em + 20px); /* rows=3 を目安に少し余白 */
  margin-bottom: 12px;
}

.map-page .textarea2 {
  width: 100%;
  box-sizing: border-box;
  line-height: 1.5;          /* 行間 */
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  resize: vertical;          /* 必要なら高さを縦方向だけ変更可 */
  min-height: calc(1.5em * 3 + 20px); /* rows=3 を目安に少し余白 */
  margin-bottom: 12px;
}

.map-page .form-map{
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: clamp(200px, 50vh, 300px); /* 一定以上で縦サイズ上限 */
  overflow: auto;                        /* はみ出したらスクロール */
  -webkit-overflow-scrolling: touch;     /* iOSで慣性スクロール */
  padding-right: 8px;                    /* スクロールバー分の余白（任意） */
  margin-bottom: 15px;
}

.map-page .round-btn{
  align-self: center;
  width: 40px;
  height: 40px;
  border: none;
  border-radius: 50%;
  background: linear-gradient(145deg, #d9f0d0, #b2d8a4);
  color: #7c7c7c;
  font-size: 28px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  margin-bottom: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,.15);
  transition: transform .12s ease, box-shadow .12s ease;
}
.map-page .round-btn:hover{ transform: scale(1.03); }
.map-page .round-btn:active{ transform: scale(0.97); }

.map-page .toggle-row{
  display:flex;
  align-items:center;    /* 縦中央 */
  gap:12px;              /* 文字とスイッチの間隔 */
  cursor:pointer;
  user-select:none;
  /* border-bottom: 1px dashed #999; 点線の区切り */
}

.map-page .dashed-line {
  border: none;
  border-bottom: 1px dashed #999;
  margin: 5px 0;
}

.map-page .toggle-text{
  line-height:1.3;
  margin-left: 20px;
  margin-top: 10px;
  font-size: 16px;
}
.map-page {
  --sw: 40px;  /* スイッチ全体の幅 */
  --sh: 20px;  /* 高さ */
  --pad: 3px;  /* つまみの余白 */
  --knob: calc(var(--sh) - var(--pad)*2);
  --travel: calc(var(--sw) - var(--sh)); /* 左→右の移動距離（幅-高さ） */
}

.map-page .switch{
  position: relative;
  display: inline-block;
  width: var(--sw);
  height: var(--sh);
  flex-shrink: 0;
}

.map-page .switch input{
  position:absolute;
  opacity:0;
  width:0; height:0;
}

.map-page .switch{
  margin-left: auto;
  margin-top: 12px;
}

.map-page .slider{
  position:absolute;
  inset:0;
  background:#777;
  border-radius: var(--sh);
  transition: background .2s ease;
}

.map-page .slider::before{
  content:"";
  position:absolute;
  left: var(--pad);
  bottom: var(--pad);
  width: var(--knob);
  height: var(--knob);
  background:#fff;
  border-radius: 50%;
  transition: transform .2s ease;
  box-shadow: 0 1px 3px rgba(0,0,0,.3);
}

.map-page .switch input:checked + .slider{
  background:#007bff;
}

.map-page .switch input:checked + .slider::before{
  transform: translateX(var(--travel));
}

.map-page .map-button {
  background: linear-gradient(145deg, #d9f0d0, #b2d8a4);
  display:block;
  width: 100%;
  max-width: 300px;        /* スマホ幅に最適化 */
  border: none;
  border-radius: 8px;
  padding: 10px;
  margin: 0 auto;       /* 中央寄せ */
  margin-top: 30px;
  margin-bottom: 15px;
  margin-left: 10px;
  font-size: 14px;
  box-shadow: 3px 3px 8px rgba(0,0,0,0.2), 
              -2px -2px 6px rgba(255,255,255,0.6);
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

.map-page .map-button:active {
  box-shadow: inset 3px 3px 8px rgba(0,0,0,0.2), 
              inset -2px -2px 6px rgba(255,255,255,0.6);
  background: linear-gradient(145deg, #b2d8a4, #d9f0d0);
  transform: scale(0.98);
}

.map-page .map-button-box {
  margin-bottom: 50px;
}

.map-page nav {
    position: fixed;
    top: 24px;
    width: 100%;
    z-index: 10;
}
.map-page .hamburger {
    position: absolute;
    top: 32px;
    right:32px;
    cursor: pointer;
    width: 32px;
    height: 24px;
    z-index: 10;
}
.map-page .hamburger span {
    transition: all .3s;
    position: absolute;
    height: 2px;
    background-color: #333;
    width:100%;
    z-index: 10;
}
.map-page .hamburger span:nth-of-type(1) {
    top: 4px;
}
.map-page .hamburger span:nth-of-type(2) {
    top: 12px;
}
.map-page .hamburger span:nth-of-type(3) {
    top: 20px;
}
.map-page .hamburger.open span:nth-of-type(1) {
    top: 10px;
    transform: translateY(6px) rotate(-25deg);
}
.map-page .hamburger.open span:nth-of-type(2) {
    opacity: 0;
}
.map-page .hamburger.open span:nth-of-type(3) {
    top: 22px;
    transform: translateY(-6px) rotate(25deg);
}

.map-page .header { position: relative; }

.map-page .backdrop{
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  z-index: 8;
}

.map-page .hamburger{ z-index: 10; }

.map-page .header { position: relative; z-index: 20; }
.map-page .header-bar{
  width: 100%;
  max-width: 320px;        /* スマホ幅に最適化 */
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 16px;
}

.map-page .map-title{
  width: 230px;
  font-size: 14px;
  text-align: center;
  margin: 0;
  margin-top: 12;
  font-size: 15px;
  font-weight: 700;
  color: #333;
}

.map-page .hamburger{
  position: static;
  width: 50px;
  height: 30px;
  cursor: pointer;
  border: 0;
  background: transparent;
  padding: 0;
  display: inline-block;
  /* background-color: #b2d8a4; */
}

.map-page .hamburger span{
  display: block;
  transition: all .3s;
  position: relative;
  height: 2px;
  background-color: #333;
  width: 100%;
}
.map-page .hamburger span:nth-of-type(1){ top: 4px; }
.map-page .hamburger span:nth-of-type(2){ top: 14px; }
.map-page .hamburger span:nth-of-type(3){ top: 24px; }

.map-page .hamburger.open span:nth-of-type(1){
  top: 10px; transform: translateY(8px) rotate(-45deg);
}
.map-page .hamburger.open span:nth-of-type(2){ opacity: 0; }
.map-page .hamburger.open span:nth-of-type(3){
  top: 22px; transform: translateY(-8px) rotate(45deg);
}

.map-page #header-menu{
 display: none;                 /* jQueryのslideToggle用 */
  position: fixed;               /* 画面に固定 */
  top: 56px;                     /* ヘッダーの下あたりに表示 */
  left: 50%;
  transform: translateX(-50%);   /* 水平中央揃え */  
  flex: 1 1 auto;
  min-height: 0;
  width: 100vw;
  height: auto;       /* ← ここが重要（99vhをやめる） */
  max-width: none;    /* ← 320pxの上限を解除 */
  margin: 0;          /* ← 余白で溢れないように */
  overflow: auto;
  padding: 16px;
  background-color: #fff;
  margin-top: 30px;
  z-index: 1000;
}

.map-page #header-menu .map-container{
  margin: 0 auto 20px;
  max-width: 320px;
  width: 100%;
}

.map-page .maps {
  display: none;
  position: absolute;/*←絶対位置*/
  bottom: 0;
}

.map-page #map {
  /* height: 99vh; */
  height: 99vh;
  width: 100%;
  max-width: 320px;
  margin-top: 15px;
  z-index: 0 !important; /* map本体を背面に下げる */
}

/* 画面全体を1ページに固定 */
/* .map-page html, body {
  height: 100dvh;
  margin: 0;
  overflow: hidden;
} */

/* mapページ全体をスクロールさせたくないなら */
.map-page {
  height: 100dvh;
  overflow: hidden;
}

/* ヘッダー + MAP の2分割（縦） */
.map-page .container{
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
}

/* ヘッダー行（高さ固定） */
.map-page .header-bar{
  height: var(--header-h);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 16px;
}

/* MAPは残り全部を占有（高さは自動） */
.map-page #map{
  flex: 1 1 auto;
  min-height: 0;
  width: 100vw;
  height: auto;       /* ← ここが重要（99vhをやめる） */
  max-width: none;    /* ← 320pxの上限を解除 */
  margin: 0;          /* ← 余白で溢れないように */
}

.map-page {
  --header-h: 56px;   /* ヘッダー実高さに合わせて調整 */
  --menu-pad: 16px;   /* #header-menu の padding と同値 */
}

/* メニュー全体（必要なら） */
.map-page #header-menu{
  height: calc(100dvh - var(--header-h));
  top: var(--header-h);
  padding: var(--menu-pad);
  overflow: hidden;          /* 内側のスクロールは .map-container に委譲 */
}

/* ← ここを max-height → height に変更 */
.map-page .map-container{
  height: calc(100dvh - var(--header-h) - var(--menu-pad) * 2);
  overflow: auto;
  box-sizing: border-box;
}

/* iOS/Safari 古め対策のフォールバック */
@supports not (height: 100dvh) {
  .map-page #header-menu{ height: calc(100vh - var(--header-h)); }
  .map-page .map-container{ height: calc(100vh - var(--header-h) - var(--menu-pad) * 2); }
}

.map-page .right-edge{
  margin-left: auto;   /* 右端へ寄せる */
  text-align: right;   /* 文字揃え（任意） */
  color: blue;
  font-size: 16px;
}

.map-page .no-scrollbar {
  scrollbar-width: none;        /* Firefox */
  -ms-overflow-style: none;     /* 旧Edge/IE */
}
.map-page .no-scrollbar::-webkit-scrollbar { display: none; }
.map-page .app-name {
  font-size: 14px;
}

/* Leaflet ボタン全体のサイズ変更 */
.map-page .leaflet-bar a {
  width: 50px !important;          /* デフォルト26px → 拡大 */
  height: 50px !important;
  line-height: 50px !important;    /* テキスト中央寄せ */
  font-size: 35px !important;      /* アイコンサイズ調整 */
  border: 1px solid #404040 !important;
}

/* ボタン間の余白（上下や左右の間隔） */
.map-page .leaflet-bar a:last-child {
  border-bottom: none;  /* 最後のボタン下線を消す */
}

/* マウスオーバー時の反応 */
.map-page .leaflet-bar a:hover {
  background-color: #f0f0f0;
}

.map-page .leaflet-bar a.custom-photo {
  font-size: 22px;   /* 絵文字を少し大きく */
  background: white; /* 背景統一 */
}
.map-page .leaflet-bar a.custom-photo.active {
  background: #acacac; /* ON状態の色 */
}

.map-page .select-btn{
  align-self: flex-start;
}
.map-page #pop-close{
  margin-left: auto;
}

.map-page .ba {
  background: linear-gradient(145deg, #d9f0d0, #b2d8a4);
  display:block;
  width: 100%;
  max-width: 100px;        /* スマホ幅に最適化 */
  border: none;
  border-radius: 8px;
  padding: 10px;
  margin: 0 auto;       /* 中央寄せ */
  margin-left: auto;  /* ボタンだけ右端へ */
  font-size: 15px;
  box-shadow: 3px 3px 8px rgba(0,0,0,0.2), 
              -2px -2px 6px rgba(255,255,255,0.6);
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

.map-page .ba-input {
  width: 150px;        /* スマホ幅に最適化 */
  flex: 1;                     /* 横幅を可変に */
  font-size: 16px;
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  outline: none;
  background-color: #fff;
  color: #333;
  margin-right: 5px;            /* ボタンとの間隔 */
  min-width: 0;                 /* flexboxで縮小時に崩れない */
  box-sizing: border-box;
}

.map-page .ba-input:focus {
  border-color: #007bff;
  box-shadow: 0 0 3px rgba(0,123,255,0.5);
}

.map-page .ba-input.is-readonly{
  background: #f7f7f7;
  border-color: #ddd;
  color: #666;
}

.map-page .ba-back.active {
  background-color: #e2f0ff;   /* 背景を青に */
  color: #fff;                 /* テキスト白に（任意） */
  border-radius: 6px;          /* 少し丸み */
  transition: background 0.2s ease;
}

/* 全画面クリック遮断。透明でもクリックは通さない */
.map-page #edit-shield[aria-hidden="false"] {
  position: fixed;
  inset: 0;
  background: transparent; /* 透過でOK、半透明にしたければ rgba(0,0,0,.2) など */
  z-index: 9999;
}

/* 編集中の行だけ操作を許可：最前面へ */
.map-page .ba-back.edit-active {
  position: relative;
  z-index: 10000; /* オーバーレイより上 */
}


/* 透明でもクリックをブロックする全画面シールド */
.map-page #edit-shield{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0); /* 透明でもOK。薄暗くしたければ0.2などに */
  z-index: 10000;            /* 画面上のほぼ全てより上 */
  pointer-events: auto;
}

/* 行のデフォルトは相対配置にしておく */
.map-page .ba-back{ position: relative; }

/* 編集中の行だけシールドより前面に出す */
.map-page .ba-back.edit-active{
  z-index: 10001;            /* シールドよりさらに上 */
  pointer-events: auto;
}

/* 念のため：ハンバーガーなどにz-indexを振っていても、シールドが上に来る */
.map-page .hamburger{ z-index: 9000; }

/* --- 強制ロック用：編集中は全要素のクリックを無効化 --- */
body.edit-lock * {
  pointer-events: none !important;
}

/* シールドと編集中の行だけ操作を許可 */
body.edit-lock #edit-shield,
body.edit-lock .ba-back.edit-active,
body.edit-lock .ba-back.edit-active * {
  pointer-events: auto !important;
}

/* シールドは最前面＆必ずクリックを受け止める */
.map-page #edit-shield {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0);           /* 透明でOK（半透明にしたければ 0.2 など） */
  z-index: 2147483647;                 /* 最高クラスのZ */
}

/* 念のため：編集中の行はシールドよりもさらに上に見せたい場合 */
.map-page .ba-back.edit-active {
  position: relative;
  z-index: 2147483647;  /* シールドと同格でもOK。視覚効果を付けたければここで */
}

.map-page .map-button.text-gray {
  color: #a7a7a7 !important;
}
.map-page .ba.text-gray {
  color: #a7a7a7 !important;
}

/* 編集中（保存ボタン表示中）の赤ボタン */
.map-page .ba-edit-btn--danger {
  background: #e53935 !important; /* 赤 */
  color: #fff !important;         /* 文字は白 */
  box-shadow: 3px 3px 8px rgba(0,0,0,0.25), -2px -2px 6px rgba(255,255,255,0.4);
}
.map-page .ba-edit-btn--danger:hover {
  filter: brightness(1.05);
}
.map-page .ba-edit-btn--danger:active {
  transform: scale(0.98);
}

.map-page .js-del-marker{
  height: 50px;
  margin-top: 8px;
  margin-bottom: 4px;
  padding: 6px 10px;
  font-size: 18px;
  border: 0;
  border-radius: 6px;
  background: #dc3545; /* 赤 */
  color: #fff;         /* 白文字 */
  cursor: pointer;
}
.map-page .js-del-marker:active{
  opacity: .9;
  transform: translateY(1px);
}

.map-page .pop-danger{
  background: #dc3545; /* 赤 */
  color: #fff;
}

/* 編集中の行全体でパン/スクロールを禁止 */
.map-page .ba-back.edit-active,
.map-page .ba-back.edit-active * {
  touch-action: none;          /* ← 指スワイプ＝スクロールをカット */
  -ms-touch-action: none;      /* 旧Edge対策 */
  user-select: none;           /* （任意）長押し選択なども抑制 */
}

/* 絵文字アイコン */
.map-page .emoji-marker .emoji {
  font-size: 28px;
  line-height: 1;
  filter: drop-shadow(0 0 2px #fff) drop-shadow(0 0 1px #fff);
  user-select: none;
}
.map-page .person-user .emoji {
  color: rgb(0, 0, 0);                /* ← これで赤に */
  text-shadow: 0 0 2px white;
}
.map-page .person-red .emoji {
  color: red;                /* ← これで赤に */
  text-shadow: 0 0 2px white;
}
@media (max-width: 768px) {
  .map-page .emoji-marker .emoji { font-size: 40px; }
}

.map-page .leaflet-interactive-off { pointer-events: none !important; }




/* === ローディング全体 === */
.map-page #loading {
  position: fixed;
  inset: 0; /* top, right, bottom, left 全て0 */
  background: rgba(0, 0, 0, 0.4); /* 半透明の背景 */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999; /* 最前面に表示 */
  color: #fff;
  font-size: 1.1rem;
  font-family: "Segoe UI", "Noto Sans JP", sans-serif;
  text-align: center;
  transition: opacity 0.3s ease;
}

/* 非表示時の状態（JSで切り替え） */
.map-page #loading.hidden {
  opacity: 0;
  pointer-events: none;
}

/* === スピナー（回転アニメーション） === */
.map-page .spinner {
  width: 48px;
  height: 48px;
  border: 5px solid rgba(255, 255, 255, 0.3);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 12px;
}

/* 回転アニメーション */
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* スマホでも見やすいように */
@media (max-width: 600px) {
  .map-page #loading {
    font-size: 1rem;
  }
  .map-page .spinner {
    width: 40px;
    height: 40px;
  }
}